<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceNow Virtual Agent - Test Page</title>

    <!-- ServiceNow Virtual Agent Portable Web Client -->
    <script type="module">
        import ServiceNowChat from "https://blueshipcoltddemo4.service-now.com/uxasset/externals/now-requestor-chat-popover-app/index.jsdbx?sysparm_substitute=false";

        // チャットインスタンスを作成して初期化
        const chat = new ServiceNowChat({
            instance: "https://blueshipcoltddemo4.service-now.com/",
            // オプション設定（必要に応じてカスタマイズ）
            context: {
                skip_load_history: 1
            },
            branding: {
                bgColor: '#667eea',
                primaryColor: '#ffffff',
                hoverColor: '#764ba2',
                activeColor: '#5568d3',
            },
            offsetX: 20,
            offsetY: 20,
            position: 'right',
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 900px;
            margin: 40px auto;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box h2 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .info-box code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
            font-size: 0.9em;
        }

        .info-box ul {
            margin-left: 20px;
            color: #555;
        }

        .info-box li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .config-section {
            background: #e7f3ff;
            border: 1px solid #2196F3;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .config-section h3 {
            color: #1976D2;
            margin-bottom: 15px;
        }

        .config-section pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .instructions ol {
            margin-left: 20px;
            color: #856404;
        }

        .instructions li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .steps-box {
            background: #f0f7ff;
            border-left: 4px solid #2196F3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .steps-box h3 {
            color: #1976D2;
            margin-bottom: 15px;
        }

        .steps-box ol {
            margin-left: 20px;
            color: #333;
        }

        .steps-box li {
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .steps-box strong {
            color: #1976D2;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            color: #999;
            font-size: 0.9em;
            padding-bottom: 20px;
        }

        .note {
            background: #fff9e6;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .note p {
            color: #663c00;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ServiceNow Virtual Agent</h1>
        <p class="subtitle">Portable Web Client - テストページ</p>

        <div class="info-box">
            <h2>このテストページについて</h2>
            <p>
                このページは、ServiceNow Virtual Agentの<strong>Portable Web Client</strong>が実装されています。
            </p>
            <p>
                <strong>実装状況：</strong> blueshipcoltddemo4.service-now.com インスタンスのチャットウィジェットが画面右下に表示されます。
            </p>
            <p>
                Portable Web Clientを使用すると、ServiceNowインスタンス外の任意のウェブサイトにVirtual Agentチャットウィジェットを統合できます。
            </p>
        </div>

        <div class="steps-box">
            <h3>セットアップ手順（ServiceNow側の設定）</h3>
            <ol>
                <li><strong>ServiceNowインスタンスにログイン</strong></li>
                <li><strong>All > Virtual Agent > Designer</strong> に移動</li>
                <li>使用するVirtual Agentトピックを選択</li>
                <li><strong>「Portable」</strong>タブをクリック</li>
                <li><strong>「Website」</strong>オプションを選択</li>
                <li><strong>「Generate Code」</strong>をクリックして埋め込みコードを生成</li>
                <li>生成されたスクリプトコードをコピー</li>
                <li>下記の「実装方法」に従ってこのHTMLファイルに貼り付け</li>
            </ol>
        </div>

        <div class="config-section">
            <h3>実装済みコード</h3>
            <p style="color: #333; margin-bottom: 15px;">
                このページには既に以下のコードが実装されています（&lt;head&gt;セクション内）：
            </p>
            <pre>&lt;script type="module"&gt;
    import ServiceNowChat from "https://blueshipcoltddemo4.service-now.com/uxasset/externals/now-requestor-chat-popover-app/index.jsdbx?sysparm_substitute=false";

    const chat = new ServiceNowChat({
        instance: "https://blueshipcoltddemo4.service-now.com/",
        context: {
            skip_load_history: 1
        },
        branding: {
            bgColor: '#667eea',
            primaryColor: '#ffffff',
            hoverColor: '#764ba2',
            activeColor: '#5568d3',
        },
        offsetX: 20,
        offsetY: 20,
        position: 'right',
    });
&lt;/script&gt;</pre>
            <p style="color: #333; margin-top: 15px;">
                <strong>ポイント：</strong> <code>type="module"</code> を使用してES6モジュールとしてインポートし、
                <code>new ServiceNowChat()</code> でチャットインスタンスを作成します。
            </p>
        </div>

        <div class="info-box">
            <h2>必要なServiceNow側の設定</h2>
            <p>Virtual Agentが正しく動作するために、ServiceNowインスタンスで以下の設定が必要です：</p>
            <ul>
                <li><strong>CORS (Cross-Origin Resource Sharing) 設定</strong>
                    <ul>
                        <li>System Web Services > REST > CORS Rules でCORSルールを作成</li>
                        <li>このウェブサイトのドメインを許可リストに追加</li>
                    </ul>
                </li>
                <li><strong>システムプロパティ設定</strong>
                    <ul>
                        <li><code>com.glide.cs.embed.csp_frame_ancestors</code>: このサイトのURLを設定</li>
                        <li><code>com.glide.cs.embed.xframe_options</code>: <code>sameorigin</code> に設定</li>
                    </ul>
                </li>
                <li><strong>Portable Web Client の有効化</strong>
                    <ul>
                        <li>Virtual Agent Designer でPortable Web Clientを有効化</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="note">
            <p>
                <strong>重要:</strong> チャットウィジェットが表示されるためには、ServiceNowインスタンス側で適切なCORS設定が必要です。
                また、Virtual Agent DesignerでPortable Web Clientが有効化されている必要があります。
            </p>
        </div>

        <div class="instructions">
            <h3>カスタマイズ可能な設定項目</h3>
            <p style="color: #856404; margin-bottom: 15px;">
                上記の実装コード内で以下のオプションをカスタマイズできます：
            </p>
            <ol>
                <li><strong>色のカスタマイズ:</strong>
                    <ul style="margin-top: 5px;">
                        <li><code>bgColor</code>: ボタンの背景色（現在: #667eea）</li>
                        <li><code>primaryColor</code>: テキスト色（現在: #ffffff）</li>
                        <li><code>hoverColor</code>: ホバー時の色（現在: #764ba2）</li>
                        <li><code>activeColor</code>: アクティブ時の色（現在: #5568d3）</li>
                    </ul>
                </li>
                <li><strong>位置の調整:</strong>
                    <ul style="margin-top: 5px;">
                        <li><code>position</code>: 'left' または 'right'（現在: right）</li>
                        <li><code>offsetX</code>, <code>offsetY</code>: ピクセル単位のオフセット（現在: 20px）</li>
                    </ul>
                </li>
                <li><strong>その他のオプション:</strong>
                    <ul style="margin-top: 5px;">
                        <li><code>openIcon</code>, <code>closeIcon</code>: カスタムアイコン</li>
                        <li><code>sizeMultiplier</code>: サイズの倍率調整</li>
                        <li><code>translations</code>: ラベルの多言語対応</li>
                    </ul>
                </li>
            </ol>
        </div>

        <footer>
            <p>ServiceNow Virtual Agent Portable Web Client - Test Page</p>
            <p style="margin-top: 10px; font-size: 0.85em;">GitHub Pages でホスティング</p>
        </footer>
    </div>

</body>
</html>
